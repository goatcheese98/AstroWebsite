---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getSession } from "../lib/middleware/auth-middleware";

const session = await getSession(Astro);
---

<BaseLayout title="Auth Test" description="Test auth session">
  <div style="padding: 2rem; max-width: 800px; margin: 0 auto;">
    <h1>Authentication Test</h1>
    
    <h2>Server-Side Session:</h2>
    <pre style="background: #f5f5f5; padding: 1rem; border-radius: 8px; overflow: auto;">
{JSON.stringify({
  hasSession: !!session,
  user: session ? {
    id: session.user.id,
    email: session.user.email,
    name: session.user.name
  } : null
}, null, 2)}</pre>

    <h2>Client-Side Session:</h2>
    <div id="client-session" style="background: #f5f5f5; padding: 1rem; border-radius: 8px;">
      Loading...
    </div>

    <div style="margin-top: 2rem;">
      <a href="/dashboard" style="display: inline-block; padding: 0.5rem 1rem; background: #667eea; color: white; text-decoration: none; border-radius: 4px; margin-right: 1rem;">
        Go to Dashboard
      </a>
      <a href="/ai-canvas" style="display: inline-block; padding: 0.5rem 1rem; background: #667eea; color: white; text-decoration: none; border-radius: 4px;">
        Go to AI Canvas
      </a>
    </div>
  </div>

  <script>
    async function checkClientSession() {
      try {
        const response = await fetch('/api/auth/debug', { credentials: 'include' });
        const data = await response.json();
        document.getElementById('client-session').innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
      } catch (error) {
        document.getElementById('client-session').textContent = 'Error: ' + error.message;
      }
    }
    checkClientSession();
  </script>
</BaseLayout>
