---
import BaseLayout from "../layouts/BaseLayout.astro";
import { CanvasContainer } from "../components/canvas";

const auth = Astro.locals.auth();
const user = await Astro.locals.currentUser();
const isSignedIn = !!auth.userId;
---

<BaseLayout
  title="AI Canvas"
  description="Interactive drawing canvas powered by Excalidraw with AI assistance"
>
  <div class="canvas-layout">
    <div class="canvas-container">
      <CanvasContainer
        client:only="react"
        isSignedIn={isSignedIn}
        userId={auth.userId}
        userName={user?.fullName || user?.username}
        avatarUrl={user?.imageUrl}
      />
    </div>
  </div>
</BaseLayout>

<style>
  .canvas-layout {
    width: 100vw;
    height: 100vh;
    position: fixed;
    top: 0;
    left: 0;
    overflow: hidden;
  }

  .canvas-container {
    width: 100%;
    height: 100%;
    position: relative;
    /* Always white background for canvas (Excalidraw default) */
    background: #ffffff !important;
    background-image: none !important;
  }

  /* Ensure body doesn't scroll when canvas is open */
  :global(body) {
    overflow: hidden !important;
    /* Prevent browser pinch zoom - let Excalidraw handle it */
    touch-action: none;
  }

  /* Prevent browser zoom on the canvas container */
  .canvas-container {
    touch-action: none;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
  }

  /* Make Excalidraw fill entire viewport */
  :global(.excalidraw-wrapper),
  :global(.excalidraw) {
    width: 100% !important;
    height: 100% !important;
  }

  /* Hide Excalidraw's default theme toggle - but keep our custom avatar */
  :global(.excalidraw .layer-ui__wrapper__top-right .custom-avatar) {
    display: flex;
  }
</style>
