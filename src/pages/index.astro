---
import PageLayout from "../layouts/PageLayout.astro";
import Hero from "../components/sections/Hero.astro";
import Projects from "../components/sections/Projects.astro";
import Experience from "../components/sections/Experience.astro";
import Contact from "../components/sections/Contact.astro";
import BentoSkills from "../components/islands/BentoSkills";
import SketchDivider from "../components/sketch/SketchDivider.astro";
---

<PageLayout title="Home">
  <Hero />

  <SketchDivider variant="wavy" />
  <Projects />
  <SketchDivider variant="zigzag" />
  <Experience />

  <section class="skills section-gap" id="skills" aria-label="Skills">
    <div class="container">
      <div class="skills__header">
        <h2 class="skills__heading">
          <span class="gradient-text">Skills & Expertise</span>
        </h2>
        <p class="skills__subhead">
          A generalist's toolkit spanning data, technology, and strategy
        </p>
        <div class="skills__header-line" aria-hidden="true"></div>
      </div>
      
      <BentoSkills client:load />
    </div>
  </section>

  <SketchDivider variant="wavy" />
  <Contact />
</PageLayout>

<script>
  import { annotate } from "rough-notation";

  function initAnnotations() {
    const reducedMotion = window.matchMedia(
      "(prefers-reduced-motion: reduce)",
    ).matches;
    const style = getComputedStyle(document.documentElement);
    const accentColor = style.getPropertyValue("--color-accent").trim();

    const el = document.querySelector("#hero-title");
    if (!el) return;

    const annotation = annotate(el as HTMLElement, {
      type: "underline",
      color: accentColor,
      animationDuration: reducedMotion ? 0 : 800,
      multiline: true,
      strokeWidth: 2,
    });

    if (!reducedMotion) {
      const observer = new IntersectionObserver(
        ([entry]) => {
          if (entry.isIntersecting) {
            annotation.show();
            observer.disconnect();
          }
        },
        { threshold: 0.3 },
      );
      observer.observe(el);
    } else {
      annotation.show();
    }
  }

  function init() {
    initAnnotations();
  }

  // Run on page load
  init();
</script>

<script>
  // Scroll-triggered reveal animations
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("visible");
          observer.unobserve(entry.target);
        }
      });
    },
    { threshold: 0.1, rootMargin: "0px 0px -50px 0px" },
  );

  function initReveal() {
    document.querySelectorAll(".reveal, .reveal-scale, .reveal-left, .reveal-right").forEach((el) => {
      observer.observe(el);
    });
  }

  initReveal();
</script>

<style>
  .skills {
    position: relative;
  }

  .skills__header {
    text-align: center;
    margin-bottom: var(--space-xl);
  }

  .skills__heading {
    font-size: var(--text-2xl);
    margin-bottom: var(--space-sm);
  }

  .skills__subhead {
    font-family: var(--font-hand);
    font-size: var(--text-lg);
    color: var(--color-text-muted);
    margin-bottom: var(--space-md);
    max-width: 500px;
    margin-inline: auto;
  }

  .skills__header-line {
    width: 60px;
    height: 4px;
    background: linear-gradient(90deg, var(--color-accent), var(--color-gradient-end));
    border-radius: 2px;
    margin: 0 auto;
    filter: url(#sketch-filter);
  }
</style>
