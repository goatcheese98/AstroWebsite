---
import SketchButton from "../ui/SketchButton.astro";
import SketchArrow from "../sketch/SketchArrow.astro";
import PathfinderBot from "../islands/PathfinderBot";
import { SITE } from "../../lib/constants";

const TITLES = [
  "Business Analyst",
  "Technical Generalist",
  "Data Product Specialist",
];
---

<section class="hero section-gap" aria-label="Introduction">
  <div class="container">
    <div class="hero__content">
      <div class="hero__text">
        <p class="hero__greeting">
          <span class="hero__greeting-line">Hi, I'm</span>
        </p>
        <h1 class="hero__name">
          <span class="gradient-text">{SITE.author}</span>
        </h1>
        <p class="hero__title">
          <span
            class="hero__title-text"
            id="hero-title"
            data-titles={JSON.stringify(TITLES)}></span>
          <span class="hero__title-cursor" aria-hidden="true">|</span>
        </p>
        <p class="hero__pitch">
          I transform complex data into actionable insights and drive strategic
          decision-making. UBC MBAN candidate with experience in wealth
          management analytics, data visualization, and cross-functional
          collaboration.
        </p>
        <div class="hero__actions">
          <SketchButton href="/#projects">
            View Projects
            <SketchArrow direction="down" size={20} />
          </SketchButton>
          <SketchButton
            href={SITE.socialLinks.linkedin || "#"}
            variant="secondary"
            target="_blank"
            rel="noopener"
          >
            LinkedIn
          </SketchButton>
        </div>
      </div>

      <div class="hero__deco" aria-hidden="true">
        <PathfinderBot client:load />
      </div>
    </div>
  </div>

  <!-- Scroll indicator -->
  <div class="hero__scroll-indicator" aria-hidden="true">
    <div class="scroll-indicator__mouse">
      <div class="scroll-indicator__wheel"></div>
    </div>
  </div>
</section>

<script>
  // Typewriter effect that cycles through titles with backspace
  function initTypewriter() {
    const el = document.querySelector("#hero-title") as HTMLElement;
    if (!el) return;

    const titles = JSON.parse(el.dataset.titles || '["Business Analyst"]');
    let titleIndex = 0;
    let charIndex = 0;
    let isDeleting = false;
    let isPaused = false;

    const type = () => {
      const currentTitle = titles[titleIndex];

      if (isPaused) {
        isPaused = false;
        setTimeout(() => {
          isDeleting = true;
          type();
        }, 2000);
        return;
      }

      if (isDeleting) {
        el.textContent = currentTitle.substring(0, charIndex - 1);
        charIndex--;

        if (charIndex === 0) {
          isDeleting = false;
          titleIndex = (titleIndex + 1) % titles.length;
          setTimeout(type, 300);
        } else {
          setTimeout(type, 40);
        }
      } else {
        el.textContent = currentTitle.substring(0, charIndex + 1);
        charIndex++;

        if (charIndex === currentTitle.length) {
          isPaused = true;
          setTimeout(type, 500);
        } else {
          setTimeout(type, 80 + Math.random() * 40);
        }
      }
    };

    setTimeout(type, 500);
  }

  initTypewriter();
</script>

<style>
  .hero {
    position: relative;
    min-height: 90vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    overflow: hidden;
  }

  .hero__content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-xl);
    position: relative;
    z-index: 1;
  }

  .hero__text {
    max-width: 600px;
    animation: fade-up 0.8s ease-out;
    flex: 1;
  }

  .hero__greeting {
    font-family: var(--font-hand);
    font-size: var(--text-xl);
    color: var(--color-text-muted);
    margin-bottom: var(--space-xs);
  }

  .hero__name {
    font-size: var(--text-4xl);
    font-weight: 700;
    margin-bottom: var(--space-sm);
    line-height: 1.1;
    letter-spacing: -0.03em;
  }

  .hero__title {
    font-family: var(--font-hand);
    font-size: var(--text-2xl);
    color: var(--color-text);
    margin-bottom: var(--space-lg);
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    min-height: 1.4em;
  }

  .hero__title-text {
    position: relative;
    background: linear-gradient(
      135deg,
      var(--color-accent),
      var(--color-gradient-end)
    );
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    white-space: nowrap;
  }

  .hero__title-cursor {
    color: var(--color-accent);
    animation: blink 1s step-end infinite;
    font-weight: 300;
  }

  @keyframes blink {
    0%,
    50% {
      opacity: 1;
    }
    51%,
    100% {
      opacity: 0;
    }
  }

  .hero__pitch {
    font-size: var(--text-lg);
    color: var(--color-text-muted);
    line-height: 1.8;
    margin-bottom: var(--space-xl);
    max-width: 50ch;
  }

  .hero__actions {
    display: flex;
    gap: var(--space-md);
    flex-wrap: wrap;
  }

  .hero__deco {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 300px;
  }

  .hero__scroll-indicator {
    position: absolute;
    bottom: var(--space-xl);
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    flex-direction: column;
    align-items: center;
    opacity: 0.5;
    animation: fade-up 0.8s ease-out 0.5s both;
  }

  .scroll-indicator__mouse {
    width: 26px;
    height: 40px;
    border: 2px solid var(--color-text-muted);
    border-radius: 13px;
    position: relative;
    filter: url(#sketch-filter);
  }

  .scroll-indicator__wheel {
    width: 4px;
    height: 8px;
    background: var(--color-text-muted);
    border-radius: 2px;
    position: absolute;
    top: 8px;
    left: 50%;
    transform: translateX(-50%);
    animation: scroll-wheel 1.5s ease-in-out infinite;
  }

  @keyframes scroll-wheel {
    0% {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    100% {
      opacity: 0;
      transform: translateX(-50%) translateY(12px);
    }
  }

  /* Desktop: side by side */
  @media (min-width: 901px) {
    .hero__content {
      flex-direction: row;
    }
  }

  /* Mobile: stacked with constellation below text */
  @media (max-width: 900px) {
    .hero__content {
      flex-direction: column;
      text-align: center;
      gap: var(--space-2xl);
      padding-block: var(--space-xl);
    }

    .hero__text {
      order: 1;
      max-width: 100%;
    }

    .hero__pitch {
      max-width: none;
      margin-inline: auto;
    }

    .hero__actions {
      justify-content: center;
    }

    .hero__deco {
      order: 2;
    }
  }

  @media (max-width: 640px) {
    .hero__name {
      font-size: var(--text-3xl);
    }

    .hero__title {
      font-size: var(--text-xl);
      justify-content: center;
    }

    .hero__scroll-indicator {
      display: none;
    }
  }
</style>
